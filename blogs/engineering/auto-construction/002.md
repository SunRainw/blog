---
title: Grunt
date: 2021-06-29
tags:
 - 自动化构建
categories:
 - 前端工程化
sidebar: auto
---

## Grunt的基本使用

1. 通过`yarn init`初始化一个项目
2. 添加grunt模块，在项目的根目录下添加gruntfile.js文件，作为入口文件，内容如下：
```javaScript
// Grunt的入口文件
// 用于定义一些需要Grunt自动执行的任务
// 需要导出一个函数，接收一个grunt的形参，内部提供一些创建任务时可以用到的API
module.exports = grunt => {
    // 通过grunt.registerTask来注册一个任务，接收两个参数，一个参数指定任务名，第二参数指定回调函数
    grunt.registerTask('foo', () => {
        console.info("hello grunt~")
    })

    // 可以添加多个任务
    // 如果第二个参数是字符串，就是这个任务的描述，可以通过yarn grunt --help得到grunt的帮助信息
    grunt.registerTask('bar', '帮助信息', () => {
        console.info("other grunt~")
    })

    // 如果注册的名字是default，这个任务就会成为grunt的默认任务,运行时就不需要添加名称
    // grunt.registerTask('default', '帮助信息', () => {
    //     console.info("default grunt~")
    // })

    // 一般default用于映射一些其他任务，将其参数传入一个数组，这样执行yarn grunt就会自动按顺序执行数组中的任务
    grunt.registerTask('default', ['foo', 'bar'])

    // 异步任务，此时改异步任务不会直接hi下，因为grunt默认是同步的
    grunt.registerTask('async-task', '帮助信息', () => {
        setTimeout(() => {
            console.log('async task working')
        }, 1000)
    })

    // 
    grunt.registerTask('async-task', '帮助信息', function() {
        const done = this.async() // 需要在函数中使用this来获取async回调函数
        setTimeout(() => {
            console.log('async task working')
            done() // 执行用于标识任务完成，grunt会等待done的执行才会结束任务的执行
        }, 1000)
    })
}
```
3. 创建完以后直接在命令行中使用yarn grunt <taskName>来执行任务

