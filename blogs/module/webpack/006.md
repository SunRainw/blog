---
title: Webpack的babel深入解析
date: 2021-07-26
tags:
  - webpack
categories:
  - 前端工程化
sidebar: auto
---

## Babel基础
### 为什么需要babel

事实上，在开发中我们很少直接接触`babel`，但`babel`对于前端开发来说，目前是不可缺少的一部分

开发中，我们想要使用**ES6+**的语法，想要使用**TypeScript**，开发React项目，它们都是离不开`Babel`的，所以学习`Babel`对于我们理解代码从编写到线上的转变过程至关重要。

那么，Babel到底是什么呢

Babel是一个工具链，主要用于就浏览器或者缓解中将**ECMAScript2015+**代码转换为向后兼容版本的JavaScript，包括**语法转换**、**源代码转换**、**Polyfill**实现目标缓解缺少的功能等

```javaScript
// babel转换的例子
// ES6语法
[1, 2, 3].map(n => n + 1)

// 转换后变成ES5语法
[1, 2, 3].map(function(n) {
  return n + 1
})
```

### Babel命令行使用

`babel`本身可以作为一个独立的工具（和postcss一样），不和webpack等构建工具配置也可单独使用

如果我们需要在命令行尝试使用babel，需要安装如下库：
- @babel/core: 这是babel的核心代码，必须安装
- @babel/cli: 可以让我们在命令行使用babel

```bash
yarn add @babel/cli @babel/core --dev
# or npm install @babel/cli @babel/core -D
```

在命令行使用babel
```bash
npx babel src --out-dir dist
```

- src：是源文件的目录（也可以是文件名）
- --out-dir： 指定要输出的文件夹dist

但是这样使用，发现转换出来的代码没有变化，因为@babel/core只是babel的核心，类似于postcss，它还需要其他的插件来对代码进行编译，才能进行特定的转换
### 插件的使用

例如我们需要转换箭头函数，那么我们就可以使用箭头函数转换相关的插件：

```bash
yarn add @babel/plugin-transform-arrow-functions --dev
# or npm install @babel/plugin-transform-arrow-functions -D

npx babel src --out-dir dist --plugins=@babel/plugin-transform-arrow-functions
```
查看转换后的结果发现，箭头函数被转换成了**function函数**。但是**const**并没有转换成**var**

这是因为`plugin-transform-arrow-functions`，并没有提供这样的功能，我们需要使用`plugin-tarnform-block-scoping`来完成这样的功能

```bash
yarn add @babel/plugin-tarnform-block-scoping --dev
# or npm install @babel/plugin-tarnform-block-scoping -D

npx babel src --out-dir dist --plugins=@babel/plugin-transform-block-scoping,@babel/plugin-transform-arrow-functions
```
这样源代码的**const**、**let**就会转换成**var**，箭头函数也会转换成**function函数**

### babel的预设preset

如果要转换的内容过多，一个个设置是比较麻烦的，我们可以使用预设(preset)

安装@babel/preset-env预设
```
yarn add @babel/preset-env --dev
# or npm install @babel/preset-env --D
```

执行如下如下命令，即可将当前版本适用的ES6转换成ES5
```bash
npx babel src --out-dir dist --presets=@babel/preset-env
```