(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{527:function(t,s,a){t.exports=a.p+"assets/img/005-01.229bd322.jpeg"},528:function(t,s,a){t.exports=a.p+"assets/img/005-02.70285649.jpeg"},529:function(t,s,a){t.exports=a.p+"assets/img/005-03.f0d84529.jpeg"},564:function(t,s,a){"use strict";a.r(s);var n=a(5),r=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h2",{attrs:{id:"为什么使用performance"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#为什么使用performance"}},[t._v("#")]),t._v(" 为什么使用Performance")]),t._v(" "),n("ul",[n("li",[t._v("GC的目的是为了实现内存空间的良性循环")]),t._v(" "),n("li",[t._v("良性循环的基石是合理使用")]),t._v(" "),n("li",[t._v("必须时刻关注内存变化才能确定是否合理")]),t._v(" "),n("li",[t._v("Performance提供多种监控内存的方式，可以通过Performance实时监控内存变化")])]),t._v(" "),n("h2",{attrs:{id:"performance使用步骤"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#performance使用步骤"}},[t._v("#")]),t._v(" Performance使用步骤")]),t._v(" "),n("ul",[n("li",[t._v("打开浏览器输入目标网址")]),t._v(" "),n("li",[t._v("进入开发人员工具面板，选择性能")]),t._v(" "),n("li",[t._v("开启录制功能，访问具体界面")]),t._v(" "),n("li",[t._v("执行用户行为，一段时间后停止录制")]),t._v(" "),n("li",[t._v("分析界面中记录的内存信息")])]),t._v(" "),n("h2",{attrs:{id:"内存问题的体现"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#内存问题的体现"}},[t._v("#")]),t._v(" 内存问题的体现")]),t._v(" "),n("h3",{attrs:{id:"内存问题的外在表现"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#内存问题的外在表现"}},[t._v("#")]),t._v(" 内存问题的外在表现")]),t._v(" "),n("p",[t._v("(假设网络环境正常)")]),t._v(" "),n("ul",[n("li",[t._v("页面出现延迟加载或经常性暂停(可能由于有频繁的垃圾回收，说明代码让内存短时间沾满)")]),t._v(" "),n("li",[t._v("页面持续性出现糟糕的性能(可能底层存在内存膨胀，当前界面为了达到一定的运行速度，而申请了更多的内存空间，从而超过了本机的承载)")]),t._v(" "),n("li",[t._v("页面的性能随时间延长越来越差(可能存在内存泄漏，也就是代码执行过程中，回收的空间越来越少，越来越多的空间无法回收)")])]),t._v(" "),n("h2",{attrs:{id:"常见的内存监控方式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#常见的内存监控方式"}},[t._v("#")]),t._v(" 常见的内存监控方式")]),t._v(" "),n("h3",{attrs:{id:"界定内存问题的标准"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#界定内存问题的标准"}},[t._v("#")]),t._v(" 界定内存问题的标准")]),t._v(" "),n("ul",[n("li",[t._v("内存泄漏：内存使用持续升高")]),t._v(" "),n("li",[t._v("内存膨胀：在多数设备上都存在性能问题（可能在多种设备上体现，可能是由于硬件不支持，但如果对多个通用设备上测出相同的问题，就可能是程序本身的问题）")]),t._v(" "),n("li",[t._v("频繁垃圾回收：通过内存变化图进行分析")])]),t._v(" "),n("h3",{attrs:{id:"监控内存方式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#监控内存方式"}},[t._v("#")]),t._v(" 监控内存方式")]),t._v(" "),n("ul",[n("li",[t._v("浏览器任务管理器")]),t._v(" "),n("li",[t._v("Timeline时序图记录")]),t._v(" "),n("li",[t._v("对快照查找分离DOM(分离DOM也就是一中内存泄漏)")]),t._v(" "),n("li",[t._v("判断是否存在频繁的垃圾回收")])]),t._v(" "),n("h2",{attrs:{id:"任务管理器监控内存"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#任务管理器监控内存"}},[t._v("#")]),t._v(" 任务管理器监控内存")]),t._v(" "),n("ol",[n("li",[t._v("在浏览器中通过右上角更多操作的更多工具找到任务管理器(或者使用快捷键Shift+Esc)")]),t._v(" "),n("li",[t._v("选中其中一栏右键选择JS内存，主要关注内存和JS内存\n"),n("ul",[n("li",[t._v("内存表示原生内存，也就是DOM节点展示所需的内存，如果不断增大说明不停在操作DOM")]),t._v(" "),n("li",[t._v("JS内存表示JS堆，括号内表示可达引用使用的内存，如果没有变化说明没有增长，如果不停增长，说明GC没有运行，JS代码可能有问题")])])]),t._v(" "),n("li",[t._v("缺点是任务管理器监控内存只能告诉我们有没有问题，而不能定位问题")])]),t._v(" "),n("h2",{attrs:{id:"timeline记录内存"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#timeline记录内存"}},[t._v("#")]),t._v(" Timeline记录内存")]),t._v(" "),n("ul",[n("li",[t._v("在浏览器的任务管理器中无法定位具体问题，可以通过浏览器性能(performance)功能的时间线记录内存，可以让我们精确定位内存异常问题发生的时间和代码")]),t._v(" "),n("li",[t._v("通过模拟一连串dom操作，会发现在dom操作期间内存瞬间飙升，然后趋于平稳，接着出现下降，然后再次点击时发现如此往复。")]),t._v(" "),n("li",[t._v("内存占用的下降就说明v8的垃圾回收启动，在js代码趋于稳定期间运行垃圾回收清理内存。")]),t._v(" "),n("li",[t._v("如果出现内存一直增长，没有内存的下降，就说明可能有内存问题，很有可能是内存泄漏")]),t._v(" "),n("li",[t._v("我们还可以通过时间线监控在那个时段发生了内存问题，且可以看到此时的DOM变化。")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(527),alt:"内存变化图"}}),t._v("\n图1 内存变化图")]),t._v(" "),n("h2",{attrs:{id:"堆快照查找分离dom"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#堆快照查找分离dom"}},[t._v("#")]),t._v(" 堆快照查找分离DOM")]),t._v(" "),n("h3",{attrs:{id:"什么事分离dom"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#什么事分离dom"}},[t._v("#")]),t._v(" 什么事分离DOM")]),t._v(" "),n("ul",[n("li",[t._v("界面元素存活在DOM树上")]),t._v(" "),n("li",[t._v("垃圾对象时的DOM节点(脱离了DOM树，且没有js代码引用的DOM节点)")]),t._v(" "),n("li",[t._v("分离状态的DOM节点(脱了DOM树，在js代码中还有引用，虽然看不见，但在js内存中还占用空间)")])]),t._v(" "),n("blockquote",[n("p",[t._v("演示分离DOM")])]),t._v(" "),n("div",{staticClass:"language-javaScript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("body"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("button id"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"btn"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("add"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("button"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("script"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" tmpEle"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("fn")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" ul "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElement")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ul"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" li "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElement")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"li"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                ul"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("appendChild")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("li"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            tmpEle "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ul"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 此处只是将ul挂到了tmpEle上面, 但是又没有挂载到页面上, 这里的11个节点就是分离DOM")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        document"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getElementById")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"btn"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"click"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" fn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("script"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("body"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br")])]),n("p",[t._v("运行这个html然后在点击事件前后获取堆快照发现如图2和图3所示")]),t._v(" "),n("p",[n("img",{attrs:{src:a(528),alt:"点击前的堆快照"}}),t._v("\n图2 点击前的堆快照图示")]),t._v(" "),n("p",[n("img",{attrs:{src:a(529),alt:"点击后的堆快照"}}),t._v("\n图3 点击后的堆快照图示")]),t._v(" "),n("ul",[n("li",[t._v("当未点击add之前，堆快照中未发现分离的DOM，而点击后则发现多出的11新的DOM节点，又没有挂在DOM树上都是分离的DOM")]),t._v(" "),n("li",[t._v("要清除这些分离的DOM只需要，"),n("code",[t._v("tmpEle = null")]),t._v("，将temEle置为null即可，这样新产生的DOM节点就没有被引用，也就会被当做垃圾回收")]),t._v(" "),n("li",[t._v("堆快照可用于专门查找分离DOM，这种页面中未渲染，却被对象引用，占用内存，这样就会造成内存浪费，我们就可以通过堆快照去查找这些分离的DOM节点然后在代码中将其清除，GC就会将其回收，避免内存浪费。")])]),t._v(" "),n("h2",{attrs:{id:"判断是否存在频繁gc"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#判断是否存在频繁gc"}},[t._v("#")]),t._v(" 判断是否存在频繁GC")]),t._v(" "),n("h3",{attrs:{id:"为什么确定频繁垃圾回收"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#为什么确定频繁垃圾回收"}},[t._v("#")]),t._v(" 为什么确定频繁垃圾回收")]),t._v(" "),n("ul",[n("li",[t._v("GC工作时应用程序是停止的")]),t._v(" "),n("li",[t._v("频繁且过长的GC会导致应用假死")]),t._v(" "),n("li",[t._v("用户使用中感知应用卡顿")])]),t._v(" "),n("h3",{attrs:{id:"确定频繁的垃圾回收"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#确定频繁的垃圾回收"}},[t._v("#")]),t._v(" 确定频繁的垃圾回收")]),t._v(" "),n("ul",[n("li",[t._v("Timeline中频繁的上升下降")]),t._v(" "),n("li",[t._v("任务管理器中数据频繁的增加减小")])]),t._v(" "),n("h2",{attrs:{id:"performance总结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#performance总结"}},[t._v("#")]),t._v(" Performance总结")]),t._v(" "),n("ul",[n("li",[t._v("Performance使用流程")]),t._v(" "),n("li",[t._v("内存问题的相关分析(内存泄漏、内存膨胀、频繁GC)")]),t._v(" "),n("li",[t._v("Performance时序图监控内存变化")]),t._v(" "),n("li",[t._v("任务管理器监控内存变化")]),t._v(" "),n("li",[t._v("堆快照查找分离DOM")])])])}),[],!1,null,null,null);s.default=r.exports}}]);